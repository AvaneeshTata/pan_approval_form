sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";var t;return e.extend("panapproval.ext.controller.PanDetailsObj",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},onBeforeRendering:async function(){},onAfterRendering:async function(){debugger},routing:{onBeforeBinding:async function(e){debugger;this.getView().setVisible(false);var n=this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].setUploadEnabled(false);var a=this;var o=window.location.href;var s=o.split("(");var i=s[1];var l=i.split("'");var r=this.base.getExtensionAPI().getModel();var g="validateUser";let d=r.bindContext(`/${g}(...)`);d.setParameter("ID",l[1]);await d.execute();let c=d.getBoundContext();let m=c.getObject();var u=JSON.parse(m.value);if(u.status=="User Found"){this.getView().setVisible(true);var p=this.base.getView().getContent()[0];p.attachSectionChange(function(){debugger;var e=this.getScrollingSectionId();sap.ui.getCore().byId("panapproval::PAN_Details_APRObjectPage--fe::table::tab1tovendor_data::LineItem::VendorData").mAggregations._content.getRows().forEach(async e=>{await e.getCells()[9].removeStyleClass("css1");await e.getCells()[1].removeStyleClass("css1");await e.getCells()[9].addStyleClass("css1");await e.getCells()[1].addStyleClass("css1")})});var C=this.base.getAppComponent().getManifestObject()._oBaseUri._string;await $.ajax({url:C+`odata/v4/pan-approval/PAN_Details_APR/${l[1]}`,success:function(e){a.getView().getContent()[0].getFooter().setVisible(true);if(e.status=="Approved"||e.status=="Rejected"||e.status=="Justification Needed")a.getView().getContent()[0].getFooter().setVisible(false)},error:function(e,t,n){console.error(n)}});await $.ajax({url:C+`odata/v4/pan-approval/PAN_Details_APR/${l[1]}/tab1toWORKFLOW_HISTORY`,success:function(e){console.log(e);v(e)},error:function(e,t,n){console.error(n)}});function v(e){var n=e.value;var o=[];n.forEach(e=>{o.push({level:e.level,Notification_Status:e.Notification_Status,Title:e.Title,Employee_ID:e.Employee_ID,Employee_Name:e.Employee_Name,"Begin_Date/_Time":e.Begin_DateAND_Time,"End_Date/_Time":e.End_DateAND_Time,Days_Taken:e.Days_Taken,Status:e.Result,By_User:e.Approved_by})});let s=a.base.getView().getContent()[0].getSections()[3];let i=o.sort((e,t)=>e.level>t.level?1:e.level<t.level?-1:0);let l=[];let r=[];let g;let d;let c=i.length-1;i.forEach((e,t)=>{g=e.level;if(d!=undefined){if(g!==d){l.push(r);r=[]}}r.push(e);d=e.level;if(t==c){l.push(r)}});s.destroySubSections();s.addSubSection(new sap.uxap.ObjectPageSubSection({}));let m=s.getSubSections();let u=m[m.length-1];u.addBlock(new sap.m.ScrollContainer({horizontal:true,vertical:true,visible:true,height:"200px"}));let p=u.getBlocks()[0];p.addContent(new sap.m.HBox({width:"100%",alignItems:"End",alignContent:"End"}));let C=p.getContent();let v=C[C.length-1];v.addItem(new sap.m.HBox({width:"90%"}));v.addItem(new sap.m.Button({text:"Comment History",press:async function(e){function n(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var n=t+"-"+e;return n}if(!t){t=new sap.m.Dialog({title:"Approval Comments",endButton:new sap.m.Button({text:"Close",press:async function(){t.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})})}t.addContent(new sap.m.VBox({width:"60vw"}));let a="getcomments";let o=e.getSource().getModel().bindContext(`/${a}(...)`);console.log();var s=window.location.href;var i=s.split("(");var l=i[1];var r=l.split("'");var g=r[1];o.setParameter("ID",g);await o.execute();const d=o.getBoundContext();let c=d.getValue();c=JSON.parse(c.value);const m=[];const u=c[0];if(u==undefined){var p=new sap.suite.ui.commons.TimelineItem({text:"No Comments Found"});t.getContent()[0].destroyItems();t.getContent()[0].addItem(p)}else{c.forEach(e=>{const t=e.createdAt;const n=e.createdBy;const a=e.modifiedAt;const o=e.modifiedBy;const s=e.idd;const i=e.PAN_Number;const l=e.user;const r=e.Comments;const g=e.status;m.push({firsname:l,lname:g,comment:r,dateTime:t})});t.getContent()[0].destroyItems();for(let e=0;e<m.length;e++){var p=new sap.suite.ui.commons.TimelineItem({id:`${"item"+n()}`,dateTime:`${m[e].dateTime}`,title:`${m[e].lname}`,userNameClickable:false,userNameClicked:"onUserNameClick",select:"onPressItems",userPicture:"Photo",text:`${m[e].comment}`,userName:`${m[e].firsname}`});t.mAggregations.content[0].addItem(p)}}t.open()}}));l.forEach(e=>{p.addContent(new sap.uxap.ObjectPageSubSection({}));let t=p.getContent();let n=t[t.length-1];n.addBlock(new sap.m.VBox(`Box-${e[0].level}`));let a=n.getBlocks()[0];a.addItem(new sap.m.HBox({alignItems:"Center"}));let o=a.getItems()[0];o.addItem(new sap.m.Label({text:`Level ${e[0].level}`,design:"Bold"}));o.addItem(new sap.m.HBox({width:"40%"}));o.addItem(new sap.m.Label({text:`Notification: `}));o.addItem(new sap.m.Switch(`SwitchLevel--${e[0].level}`,{enabled:false,type:"AcceptReject",state:e[0].Notification_Status==="true",change:function(e){}}));a.addItem(new sap.m.Table({visible:true}));let s=a.getItems()[1];let i=Object.keys(e[0]);i=i.slice(2);let l=[];i.forEach(e=>{if(!l.includes(e)){var t=new sap.m.Column({header:new sap.m.Label({text:e.replace(/_/g," ")}),width:"200px"});s.addColumn(t);l.push(e)}});e.forEach(e=>{let t=[];let n;let a=Object.values(e);a=a.slice(2);let o;a.forEach(e=>{o=new sap.m.Text({text:e});t.push(o)});n=new sap.m.ColumnListItem({cells:t});s.addItem(n)})})}this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().setEditable(true);this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().getFormContainers()[0].getFormElements()[0].getFields()[0].getContent().setEditMode("Editable");this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().getFormContainers()[0].getFormElements()[0].getFields()[0].getContent().getContentEdit()[0].setEditable(true);sap.ui.getCore().byId("panapproval::PAN_Details_APRObjectPage--fe::FooterBar").setEnabled(true)}else{alert("You are Unauthorized to access this site!!")}},onAfterBinding:async function(e){debugger;var t=e.oBinding.sPath;const n=/'([^']+)'/;const a=t.match(n);const o=a[1];var s=this.base.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].mBindingInfos.items.binding;s.filter(new sap.ui.model.Filter({path:"PAN_Number",operator:sap.ui.model.FilterOperator.EQ,value1:o}))}}}})});