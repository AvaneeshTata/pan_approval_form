sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/uxap/ObjectPageSubSection"],function(e,t){"use strict";var n;return e.extend("panapproval.ext.controller.PanDetailsObj",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},onBeforeRendering:async function(){},onAfterRendering:async function(){},routing:{onBeforeBinding:async function(e){this.getView().setVisible(false);var a=this.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].setUploadEnabled(false);var o=this;var s=window.location.href;var i=s.split("(");var l=i[1];var r=l.split("'");var g=this.base.getExtensionAPI().getModel();var d="validateUser";let c=g.bindContext(`/${d}(...)`);c.setParameter("ID",r[1]);await c.execute();let m=c.getBoundContext();let u=m.getObject();var p=JSON.parse(u.value);if(p.status=="User Found"){this.getView().setVisible(true);var C=this.base.getView().getContent()[0];C.attachSectionChange(function(){var e=this.getScrollingSectionId();sap.ui.getCore().byId("panapproval::PAN_Details_APRObjectPage--fe::table::tab1tovendor_data::LineItem::VendorData").mAggregations._content.getRows().forEach(async e=>{await e.getCells()[9].removeStyleClass("css1");await e.getCells()[1].removeStyleClass("css1");await e.getCells()[9].addStyleClass("css1");await e.getCells()[1].addStyleClass("css1")})});var v=this.base.getAppComponent().getManifestObject()._oBaseUri._string;await $.ajax({url:v+`odata/v4/pan-approval/PAN_Details_APR/${r[1]}`,success:function(e){o.getView().getContent()[0].getFooter().setVisible(true);if(e.status=="Approved"||e.status=="Rejected"||e.status=="Justification Needed")o.getView().getContent()[0].getFooter().setVisible(false)},error:function(e,t,n){console.error(n)}});await $.ajax({url:v+`odata/v4/pan-approval/PAN_Details_APR/${r[1]}/tab1toWORKFLOW_HISTORY`,success:function(e){console.log(e);f(e)},error:function(e,t,n){console.error(n)}});function f(e){var a=e.value;var s=[];a.forEach(e=>{s.push({level:e.level,Notification_Status:e.Notification_Status,Title:e.Title,Employee_ID:e.Employee_ID,Employee_Name:e.Employee_Name,"Begin_Date/_Time":e.Begin_DateAND_Time,"End_Date/_Time":e.End_DateAND_Time,Days_Taken:e.Days_Taken,Status:e.Result,By_User:e.Approved_by})});let i=o.base.getView().getContent()[0].getSections()[3];let l=s.sort((e,t)=>e.level>t.level?1:e.level<t.level?-1:0);let r=[];let g=[];let d;let c;let m=l.length-1;l.forEach((e,t)=>{d=e.level;if(c!=undefined){if(d!==c){r.push(g);g=[]}}g.push(e);c=e.level;if(t==m){r.push(g)}});i.destroySubSections();i.addSubSection(new t({}));let u=i.getSubSections();let p=u[u.length-1];p.addBlock(new sap.m.ScrollContainer({horizontal:true,vertical:true,visible:true,height:"200px"}));let C=p.getBlocks()[0];C.addContent(new sap.m.HBox({width:"100%",alignItems:"End",alignContent:"End"}));let v=C.getContent();let f=v[v.length-1];f.addItem(new sap.m.HBox({width:"90%"}));f.addItem(new sap.m.Button({text:"Comment History",press:async function(e){function t(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var n=t+"-"+e;return n}if(!n){n=new sap.m.Dialog({title:"Approval Comments",endButton:new sap.m.Button({text:"Close",press:async function(){n.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})})}n.addContent(new sap.m.VBox({width:"60vw"}));let a="getcomments";let o=e.getSource().getModel().bindContext(`/${a}(...)`);console.log();var s=window.location.href;var i=s.split("(");var l=i[1];var r=l.split("'");var g=r[1];o.setParameter("ID",g);await o.execute();const d=o.getBoundContext();let c=d.getValue();c=JSON.parse(c.value);const m=[];const u=c[0];if(u==undefined){var p=new sap.suite.ui.commons.TimelineItem({text:"No Comments Found"});n.getContent()[0].destroyItems();n.getContent()[0].addItem(p)}else{c.forEach(e=>{const t=e.createdAt;const n=e.createdBy;const a=e.modifiedAt;const o=e.modifiedBy;const s=e.idd;const i=e.PAN_Number;const l=e.user;const r=e.Comments;const g=e.status;m.push({firsname:l,lname:g,comment:r,dateTime:t})});n.getContent()[0].destroyItems();for(let e=0;e<m.length;e++){var p=new sap.suite.ui.commons.TimelineItem({id:`${"item"+t()}`,dateTime:`${m[e].dateTime}`,title:`${m[e].lname}`,userNameClickable:false,userNameClicked:"onUserNameClick",select:"onPressItems",userPicture:"Photo",text:`${m[e].comment}`,userName:`${m[e].firsname}`});n.mAggregations.content[0].addItem(p)}}n.open()}}));r.forEach(e=>{C.addContent(new t({}));let n=C.getContent();let a=n[n.length-1];a.addBlock(new sap.m.VBox(`Box-${e[0].level}`));let o=a.getBlocks()[0];o.addItem(new sap.m.HBox({alignItems:"Center"}));let s=o.getItems()[0];s.addItem(new sap.m.Label({text:`Level ${e[0].level}`,design:"Bold"}));s.addItem(new sap.m.HBox({width:"40%"}));s.addItem(new sap.m.Label({text:`Notification: `}));s.addItem(new sap.m.Switch(`SwitchLevel--${e[0].level}`,{enabled:false,type:"AcceptReject",state:e[0].Notification_Status==="true",change:function(e){}}));o.addItem(new sap.m.Table({visible:true}));let i=o.getItems()[1];let l=Object.keys(e[0]);l=l.slice(2);let r=[];l.forEach(e=>{if(!r.includes(e)){var t=new sap.m.Column({header:new sap.m.Label({text:e.replace(/_/g," ")}),width:"200px"});i.addColumn(t);r.push(e)}});e.forEach(e=>{let t=[];let n;let a=Object.values(e);a=a.slice(2);let o;a.forEach(e=>{o=new sap.m.Text({text:e});t.push(o)});n=new sap.m.ColumnListItem({cells:t});i.addItem(n)})})}this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().setEditable(true);this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().getFormContainers()[0].getFormElements()[0].getFields()[0].getContent().setEditMode("Editable");this.getView().getContent()[0].mAggregations.sections[4].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getContent().getFormContainers()[0].getFormElements()[0].getFields()[0].getContent().getContentEdit()[0].setEditable(true);sap.ui.getCore().byId("panapproval::PAN_Details_APRObjectPage--fe::FooterBar").setEnabled(true)}else{alert("You are Unauthorized to access this site!!")}},onAfterBinding:async function(e){var t=e.oBinding.sPath;const n=/'([^']+)'/;const a=t.match(n);const o=a[1];var s=this.base.getView().getContent()[0].getSections()[2].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent().getItems()[1].mBindingInfos.items.binding;s.filter(new sap.ui.model.Filter({path:"PAN_Number",operator:sap.ui.model.FilterOperator.EQ,value1:o}))}}}})});